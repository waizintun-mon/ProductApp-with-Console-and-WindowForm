<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Management</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        crossorigin="anonymous">
</head>

<body class="p-4">
    <h2 class="mb-4">🛒 Product Management</h2>

    <div class="row mb-3">
        <div class="col-md-3">
            <label class="form-label">Product Name</label>
            <input type="text" class="form-control" id="txtProductName">
        </div>
        <div class="col-md-3">
            <label class="form-label">Price</label>
            <input type="number" class="form-control" id="txtPrice" step="0.01">
        </div>
        <div class="col-md-3">
            <label class="form-label">Quantity</label>
            <input type="number" class="form-control" id="txtQuantity">
        </div>
        <div class="col-md-3 d-flex align-items-end">
            <button type="button" class="btn btn-success w-100" onclick="save()">💾 Save Product</button>
        </div>
    </div>

    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>Action</th>
                <th>#</th>
                <th>Product ID</th>
                <th>Name</th>
                <th>Price ($)</th>
                <th>Quantity</th>
            </tr>
        </thead>
        <tbody id="tbData"></tbody>
    </table>

    <script>
        loadData();
        var editId = null;

        function getData() {
            let jsonStr = localStorage.getItem('products');
            let lst = JSON.parse(jsonStr);
            if (!lst) lst = [];
            return lst;
        }

        function loadData() {
            const tbody = document.getElementById('tbData');
            tbody.innerHTML = '';

            let lst = getData();
            for (let i = 0; i < lst.length; i++) {
                const item = lst[i];
                const tr = `
                    <tr>
                        <td>
                            <button class="btn btn-warning btn-sm" onclick="edit('${item.ProductId}')">Edit</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteData('${item.ProductId}')">Delete</button>
                        </td>
                        <th scope="row">${i + 1}</th>
                        <td>${item.ProductId}</td>
                        <td>${item.ProductName}</td>
                        <td>${item.Price}</td>
                        <td>${item.Quantity}</td>
                    </tr>`;
                tbody.innerHTML += tr;
            }
        }

        function save() {
            if (editId == null) {
                saveData();
            } else {
                updateData();
            }
            clearForm();
            loadData();
        }

        function saveData() {
            const name = document.getElementById('txtProductName').value;
            const price = parseFloat(document.getElementById('txtPrice').value);
            const qty = parseInt(document.getElementById('txtQuantity').value);

            if (!name || isNaN(price) || isNaN(qty)) {
                alert("⚠️ Please enter all product details!");
                return;
            }

            const product = {
                ProductId: crypto.randomUUID(),
                ProductName: name,
                Price: price,
                Quantity: qty
            };

            let lst = getData();
            lst.push(product);
            localStorage.setItem('products', JSON.stringify(lst));
        }

        function edit(id) {
            let lst = getData();
            let product = lst.find(p => p.ProductId === id);
            if (!product) return;

            document.getElementById('txtProductName').value = product.ProductName;
            document.getElementById('txtPrice').value = product.Price;
            document.getElementById('txtQuantity').value = product.Quantity;
            editId = id;
        }

        function updateData() {
            const name = document.getElementById('txtProductName').value;
            const price = parseFloat(document.getElementById('txtPrice').value);
            const qty = parseInt(document.getElementById('txtQuantity').value);

            let lst = getData();
            let index = lst.findIndex(p => p.ProductId === editId);
            if (index === -1) return;

            lst[index].ProductName = name;
            lst[index].Price = price;
            lst[index].Quantity = qty;

            localStorage.setItem('products', JSON.stringify(lst));
            editId = null;
        }

        function deleteData(id) {
            if (!confirm("❌ Are you sure you want to delete this product?")) return;
            let lst = getData();
            lst = lst.filter(p => p.ProductId !== id);
            localStorage.setItem('products', JSON.stringify(lst));
            loadData();
        }

        function clearForm() {
            document.getElementById('txtProductName').value = '';
            document.getElementById('txtPrice').value = '';
            document.getElementById('txtQuantity').value = '';
            editId = null;
        }
    </script>

</body>
</html>
